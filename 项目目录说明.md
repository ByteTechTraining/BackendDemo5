# 零、声明

> 在项目结构说明开始之前，我想声明一点。我知道在我修改之前，这个项目是几位小伙伴的共同努力的结果，我没有任何否定各位的努力意思，我的想法很单纯，因为我曾经在某公司实习过一段时间，虽然使用的不是golang（当时用的是python），但是做的内容也是服务器端接口开发，所以在此我想凭借对接口项目的经验对我们的项目结构提出自己的一些建议。
> 
> 当然我搭建的这个结构一定有不足的地方，欢迎各位一起来探讨，设计一个更加好的项目结构，我们的目标都是一致的，都是希望在这个青训营中收获一些开发技术和经验，当然项目能够获奖就更好了。

# 一、项目结构综述

## 1. 目录树

![](https://www.hualigs.cn/image/63c83dacdc542.jpg)

## 2. 项目结构概述

   项目结构主要是参考经典的MVC分层模型。本项目主要分为

* models层(实体层)
  
  * 这层主要放置实体的结构体对象和对应的getter和setter方法。（如果采用gorm可以直接根据数据库表直接生成）

* daos层（数据访问层）
  
  * 这层主要是针对不同的实体对象编写对应CRUD方法。（说回我们这个极简版抖音项目，我们需要实现的接口并不多，所以这层可能有一些实体都不需要写代码）

* apis层（可以理解为视图层）
  
  * 这层主要是负责定义路由和handler函数。

# 二、项目结构详细说明

我们就顺着目录树从上往下阐述吧。

## apis

![](https://www.hualigs.cn/image/63c83db90c093.jpg)

* 这是这层主要包括的文件，文件目录是按照实体来划分的。(后面的daos层和models层也都是按照实体来划分的)

* 在apis中的每一个package下都会有一个urls.go文件，这个文件是用来负责初始化路由组和定义这个实体的功能路由。例子如下:
  
  ![](https://www.hualigs.cn/image/63c83dbc756a6.jpg)
  
  * 值得注意的是在douyin这个package下的urls还需要完成一个重大的功能——注册路由（也就是把douyin包下面建立的这些实体里的路由都管理起来）
  * 在青训营官方项目接口要求外，我个人还新增了一个ping接口，用于测试项目的连通性。

* 在apis中的每一个package下也都会有一个xxxHandler.go文件，这个文件主要编写处理对应路由的具体功能

## configs

![](https://s1.xptou.com/2023/01/19/63c83dc5b5c2d.png)

* 这个文件夹主要是存放这个项目所需要用到的配置文件。
  
  * 我首先想到的是数据库的相关配置，我目前写的是yaml格式，当然这个后续可以再商议，我个人是比较喜欢yaml。
  * 另外，以后如果我们需要用到阿里云的oss存储，我们也可以在这个地方新增一个关于oss的配置文件。

## daos

* 这层的话在综述中也提到了，主要就是负责实体对象的CRUD方法的实现，便于apis层来调用，达到操纵数据库的效果。

## globals

![](https://s1.xptou.com/2023/01/19/63c83dd3d8be8.png)

* 这层主要是存放一些公共的资源。例如错误代码定义、数据库定义等等
* 当然也包括我们项目需要使用到的第三方工具。例如oss
* 还有一个工具就是viper，需要介绍一下为什么需要用这个工具。因为Viper 是一个完整的 Go 应用程序配置解决方案，在构建现代应用程序时，不需要担心配置文件格式，只需要专注于构建出色的软件。
  * 这个就可以很好的解决configs中不同格式的读取问题

## logs

* 这个文件夹主要就是存放日志输出文件。

## middlewares

![](https://s1.xptou.com/2023/01/19/63c83dcfee3cc.png)

![](https://i0.hdslb.com/bfs/album/b77d7fdffcb838ca5dda82a9eddd0d6f74c0b452.png)

* 这层主要是存放我们项目所需要用到的中间件，上面是对中间件CSDN博主的理解，我觉得可以帮助不太了解中间件的小伙伴理解中间件这个概念，所以就放在这了。

* 目前我想到的就三个中间件：
  
  * 处理跨域问题的中间件
  
  * 处理日志的中间件。这个的话我们可以最后再考虑，因为gin框架默认就带有日志中间件。如果有需求的话，我们也可以搭建属于自己的日志系统。
  
  * token校验中间件。
  
  * 后续我们可能还要实现比如说限流中间件呀、越权校验中间件等等。（当然了，这都是开发后期才考虑的东西了）

## models

* 同样的，这层在综述中已经提过了，这个地方就不赘述了。

## pb

* 这个文件夹主要用来存放提供大项目说明给我们提供的用于开发的.proto文件
* 值得一提的是将所有的.proto文件从根目录移入pb后，需要更改生成脚本
  * ```protoc -I ./pb/ --go_out=. pb/*.proto```

## proto

* 这个文件夹主要用来存放由.proto文件生成的.pb.go文件

## settings

![](https://s1.xptou.com/2023/01/19/63c83f467eb2c.png)

* 不知道看到这里的小伙伴是否有疑惑，上面都有一个configs了，这个地方又来一个settings算怎么回事？是这样的，上面的configs文件夹主要存放是项目的配置文件，一般都是什么 .yaml、.ini、.toml等等。而这个settings文件夹主要就是我们这个项目的配置了，都是.go文件。包括数据库的建立、数据库对象的获取、gin引擎的初始化等。

## utils

* 这个文件夹主要就是存放一些工具方法了。例如一些时间转化方法呀、字符串操作啊等等工具类方法。

# 三、总结

由于本人文笔有限，这个说明文档写得有点啰里啰唆的，如果有哪个地方没写明白，大家可以联系我。

以上都是我凭借个人以往的经验搭建的框架，一定有不足之处，欢迎大家批评指正，我也希望在跟大家探讨的过程中学到东西，共同进步。
